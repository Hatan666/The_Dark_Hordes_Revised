#textdomain wesnoth-The_Dark_Hordes_Revised

[scenario]
    id=03_The_Skull_of_Morgorath
    name= _ "The Skull of Morgorath"
    next_scenario=04_Mages_and_Elves
    victory_when_enemies_defeated=no
    map_file=03_The_Skull_of_Morgorath.map
    {TURNS 42 38 36}
    {DAWN}
    {DAWN}
    {MORNING}
    {AFTERNOON}
    {DUSK}
    {DUSK}
    {FIRST_WATCH}
    {FIRST_WATCH}
    {FIRST_WATCH}
    {SECOND_WATCH}
    {SECOND_WATCH}
    {SECOND_WATCH}

    current_time=6

    {INTRO_AND_SCENARIO_MUSIC snowfall.ogg elf-land.ogg}
    {EXTRA_SCENARIO_MUSIC everlasting_night.ogg}

    {STORYTXT_THE_SKULL_OF_MORGORATH}
    {TDHR_TRACK {JOURNEY_03_NEW}}

    [side]
        type=Initiate
        id="Gwiti Ha'atel"
        name= _ "Gwiti Ha’atel"
        unrenamable=yes
        side=1
        canrecruit=yes
        controller=human
        {GOLD 180 160 140}
        {INCOME 6 4 2}
        user_team_name= _ "team_name^Gwiti"
        facing=se
        fog=yes
        shroud=yes
        {FLAG_VARIANT undead}
    [/side]

    [side]
        type=Orcish Warlord
        id=Karz Gholum
        name= _ "Karz Gholum"
        profile=portraits/orcs/grunt-2.webp
        side=2
        canrecruit=yes

        [ai]
            aggression=0.8
            caution=0.2
        [/ai]
#ifdef HARD
        recruit=Orcish Warrior,Orcish Crossbowman,Goblin Pillager,Troll,Troll Shaman
#endif
#ifdef NORMAL
        recruit=Orcish Grunt,Orcish Warrior,Orcish Archer,Orcish Crossbowman,Wolf Rider,Goblin Pillager,Troll
#endif
#ifdef EASY
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Troll Whelp
#endif
        {GOLD 20 40 60}
        {INCOME 2 4 6}
        team_name=enemies
        user_team_name= _ "team_name^Orcs"
        facing=nw
        {FLAG_VARIANT6 ragged}

        {GENERIC_GUARD_UNIT 2 (Orcish Archer) 11 13}
        {GENERIC_GUARD_UNIT 2 (Orcish Archer) 12 12}

#ifdef NORMAL
        {GENERIC_GUARD_UNIT 2 (Orcish Crossbowman) 19 10}
        {GENERIC_GUARD_UNIT 2 (Orcish Archer) 21 12}
#endif

#ifdef HARD
        {GENERIC_GUARD_UNIT 2 (Orcish Crossbowman) 19 10}
        {GENERIC_GUARD_UNIT 2 (Orcish Crossbowman) 21 12}
#endif

        {GENERIC_UNIT 2 (Orcish Grunt) 27 8}
        {GENERIC_UNIT 2 (Orcish Grunt) 28 12}
        {GENERIC_UNIT 2 (Orcish Warrior) 29 13}

        {GENERIC_UNIT 2 (Orcish Archer) 32 8}
        {GENERIC_UNIT 2 (Orcish Archer) 35 8}

        {GENERIC_GUARD_UNIT 2 (Wolf Rider) 36 10}
        {GENERIC_GUARD_UNIT 2 (Wolf Rider) 35 12}
    [/side]

    [side]
        type=Orcish Warlord
        id=Nakur Kimoni
        name= _ "Nakur Kimoni"
        profile=portraits/orcs/grunt-6.webp
        side=3
        canrecruit=yes

        [ai]
            aggression=0.8
            caution=0.2
        [/ai]
#ifdef HARD
        recruit=Orcish Warrior,Orcish Crossbowman,Goblin Pillager,Troll,Troll Shaman
#endif
#ifdef NORMAL
        recruit=Orcish Grunt,Orcish Warrior,Orcish Archer,Orcish Crossbowman,Wolf Rider,Goblin Pillager,Troll
#endif
#ifdef EASY
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Troll Whelp
#endif
        {GOLD 20 40 60}
        {INCOME 4 6 8}
        team_name=enemies
        user_team_name= _ "team_name^Orcs"
        facing=nw
        {FLAG_VARIANT6 ragged}

#ifdef HARD
        {GENERIC_UNIT 2 (Goblin Pillager) 43 9}
        {GENERIC_UNIT 2 (Goblin Pillager) 44 8}
#else
        {GENERIC_UNIT 2 (Wolf Rider) 43 9}
        {GENERIC_UNIT 2 (Wolf Rider) 44 8}
#endif

        {GENERIC_GUARD_UNIT 2 (Orcish Warrior) 50 5}
        {GENERIC_GUARD_UNIT 2 (Orcish Grunt) 53 8}

        [unit]
            type=Orcish Warrior
            id="Isidal B'Tai"
            name= _ "Isidal B’Tai"
            profile=portraits/orcs/grunt-5.webp
            x,y=54,7
            ai_special=guardian
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]

        {GENERIC_UNIT 2 (Orcish Grunt) 49 10}
        {GENERIC_UNIT 2 (Orcish Grunt) 54 10}
    [/side]

    # Side that appears in the second stage.
    [side]
        no_leader=yes
        hidden=yes
        side=4

        [ai]
            aggression=1.0
            caution=0.2
        [/ai]

        team_name=enemies
        user_team_name= _ "team_name^Morgorath"
        {FLAG_VARIANT wood-elvish}
    [/side]

    {CONTINUOUS_SOUND_SOURCE campfire_enemy 29 10 (ambient/campfire.ogg)}
    {SOUND_SOURCE_RANGE 2 10}

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                condition=win
                description= _ "Release the power of all the monoliths"
            [/objective]
            [objective]
                condition=lose
                description= _ "Death of Gwiti Ha’atel"
            [/objective]

            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=no
                carryover_percentage=80
            [/gold_carryover]

            {12_TURNS_NOTE}

            # Display different notes based on variable status.
            [note]
                description= _ "4 monoliths remaining."
                [show_if]
                    [variable]
                        name=monolith
                        numerical_equals=0
                    [/variable]
                [/show_if]
            [/note]
            [note]
                description= _ "3 monoliths remaining."
                [show_if]
                    [variable]
                        name=monolith
                        numerical_equals=1
                    [/variable]
                [/show_if]
            [/note]
            [note]
                description= _ "2 monoliths remaining."
                [show_if]
                    [variable]
                        name=monolith
                        numerical_equals=2
                    [/variable]
                [/show_if]
            [/note]
            [note]
                description= _ "1 monolith remaining."
                [show_if]
                    [variable]
                        name=monolith
                        numerical_equals=3
                    [/variable]
                [/show_if]
            [/note]
        [/objectives]

        # Set initial variables.
        {VARIABLE monolith 0}
        {VARIABLE second_stage no}
    [/event]

    {STARTING_VILLAGES_ALL 2}
    {STARTING_VILLAGES 3 9}
    {STARTING_VILLAGES 1 3}

    {PLACE_IMAGE scenery/monolith1.png 18 12}
    {PLACE_IMAGE scenery/monolith2.png 34 5}
    {PLACE_IMAGE scenery/monolith3.png 44 12}
    {PLACE_IMAGE scenery/monolith4.png 58 2}

    #############################
    # FIRST STAGE
    #############################
    [event]
        name=start
        [message]
            speaker=narrator
            message= _ "Gwiti was marching along the mountain path, following the lead of the Voice. Then he felt the strange magic ahead of him upon his march."
            image=wesnoth-icon.png
        [/message]
        [message]
            speaker="Gwiti Ha'atel"
            message= _ "I must be getting close to the Skull of Morgorath..."
        [/message]
        {MYSTERIOUS_VOICE ( _ "True — and you must complete the ritual to realize your goal. With your own feet and magic you must release the power of all the monoliths of the land.")}

        [sound]
            name=wail-long.wav
        [/sound]

        [remove_shroud]
            [filter_side]
                side=1
            [/filter_side]
            x,y=18,12
            radius=2
        [/remove_shroud]

        [scroll_to]
            x,y=18,12
        [/scroll_to]
        [delay]
            time=1000
        [/delay]

        [remove_shroud]
            [filter_side]
                side=1
            [/filter_side]
            x,y=34,5
            radius=2
        [/remove_shroud]

        [scroll_to]
            x,y=34,5
        [/scroll_to]
        [delay]
            time=1000
        [/delay]

        [remove_shroud]
            [filter_side]
                side=1
            [/filter_side]
            x,y=44,12
            radius=2
        [/remove_shroud]

        [scroll_to]
            x,y=44,12
        [/scroll_to]
        [delay]
            time=1000
        [/delay]

        [remove_shroud]
            [filter_side]
                side=1
            [/filter_side]
            x,y=58,2
            radius=2
        [/remove_shroud]

        [scroll_to]
            x,y=58,2
        [/scroll_to]
        [delay]
            time=1000
        [/delay]

        [scroll_to_unit]
            id="Gwiti Ha'atel"
        [/scroll_to_unit]

        {MYSTERIOUS_VOICE ( _ "These monoliths will not be activated without my magic. You shall not waste your time.")}

        {THUNDER ()}

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "I hope you have already revealed yourself to me by now. For I have never seen even your shadow."
        [/message]
        {MYSTERIOUS_VOICE ( _ "Now you need not know about myself... Your time has not yet reached that stage.")}
    [/event]

    # Spoiler: these events are meant to explain that Morgorath and Leganoth are from an alternate World.
    # Need to refine the dialogue some more. Also review for consistency.
    [event]
        name=moveto
        [filter]
            id="Gwiti Ha'atel"
            x,y=18,12
        [/filter]
        [message]
            speaker=narrator
            caption= _ "Memoirs of the Dawn"
            message= _ "<i>A long time ago, there was certainly our Golden Age in the World. We had long basked for the prosperity and glory of our time. And we had no doubt that our days of mastery over all living things would last forever.</i>"
            image=scenery/monolith1.png
            sound=magic-dark-big-miss.ogg
        [/message]
        [message]
            speaker=narrator
            caption= _ "Memoirs of the Dawn"
            message= _ "<i>But we were proven wrong: the Gods who govern us did not forgive our arrogance.</i>"
            image=scenery/monolith1.png
        [/message]

        [remove_item]
            x,y=$x1,$y1
        [/remove_item]
        [item]
            x,y=$x1,$y1
            image=scenery/monolith1.png
            halo=halo/darkens-aura.png~SCALE(150,150)
        [/item]

        [floating_text]
            x,y=$x1,$y1
            text= _ "Memoirs of the Dawn"
        [/floating_text]

        [fire_event]
            name=monolith_events
        [/fire_event]
    [/event]
    [event]
        name=moveto
        [filter]
            id="Gwiti Ha'atel"
            x,y=34,5
        [/filter]
        [message]
            speaker=narrator
            caption= _ "Memoirs of the Fall"
            message= _ "<i>After the Long and the Great War, we were eventually vanquished. So the time came when much life and lifelessness was destroyed.</i>"
            image=scenery/monolith2.png
            sound=magic-dark-big-miss.ogg
        [/message]
        [message]
            speaker=narrator
            caption= _ "Memoirs of the Fall"
            message= _ "<i>And I have been killed. The Gods disassembled my body and separated me from the World.</i>"
            image=scenery/monolith2.png
        [/message]

        [remove_item]
            x,y=$x1,$y1
        [/remove_item]
        [item]
            x,y=$x1,$y1
            image=scenery/monolith2.png
            halo=halo/darkens-aura.png
        [/item]

        [floating_text]
            x,y=$x1,$y1
            text= _ "Memoirs of the Fall"
        [/floating_text]

        [fire_event]
            name=monolith_events
        [/fire_event]
    [/event]
    [event]
        name=moveto
        [filter]
            id="Gwiti Ha'atel"
            x,y=44,12
        [/filter]
        [message]
            speaker=narrator
            caption= _ "Leganoth"
            message= _ "<i>But I succeeded to secretly hold the emissary in the World.</i>"
            image=scenery/monolith3.png
            sound=magic-dark-big-miss.ogg
        [/message]
        [message]
            speaker=narrator
            caption= _ "Leganoth"
            message= _ "<i>I entrusted him with the part of my consciousness and the means to resurrect me from the places where I am entrapped. And I gave him the name of Leganoth.</i>"
            image=scenery/monolith3.png
        [/message]

        [remove_item]
            x,y=$x1,$y1
        [/remove_item]
        [item]
            x,y=$x1,$y1
            image=scenery/monolith3.png
            halo=halo/darkens-aura.png~SCALE(150,150)
        [/item]

        [floating_text]
            x,y=$x1,$y1
            text= _ "Leganoth"
        [/floating_text]

        [fire_event]
            name=monolith_events
        [/fire_event]
    [/event]
    [event]
        name=moveto
        [filter]
            id="Gwiti Ha'atel"
            x,y=58,2
        [/filter]
        [message]
            speaker=narrator
            caption= _ "The Skull of Morgorath"
            message= _ "<i>And I keep waiting. The day when he will make arrangements to reunite my broken body, my broken bones, and my broken soul. And the day when I will once again reign as the Lord of the Darkness.</i>"
            image=scenery/monolith4.png
            sound=magic-dark-big-miss.ogg
        [/message]
        [message]
            speaker=narrator
            caption= _ "The Skull of Morgorath"
            message= _ "<i><b>The Time is infinitely near. I am knowing...</b></i>"
            image=scenery/monolith4.png
        [/message]

        [remove_item]
            x,y=$x1,$y1
        [/remove_item]
        [item]
            x,y=$x1,$y1
            image=scenery/monolith4.png
            halo=halo/darkens-aura.png
        [/item]

        [floating_text]
            x,y=$x1,$y1
            text= _ "The Skull of Morgorath"
        [/floating_text]

        [fire_event]
            name=monolith_events
        [/fire_event]
    [/event]

    # Judge the transition to the second stage.
    # There may be even better codes.
    [event]
        name=monolith_events
        first_time_only=no
        [if]
            [variable]
                name=monolith
                greater_than_equal_to=3
            [/variable]
            [then]
                {REPLACE_SCENARIO_MUSIC silence.ogg}

                {MYSTERIOUS_VOICE ( _ "Congratulations. You are finally proven to be the Chosen One.")}
                [fire_event]
                    name=second_stage
                [/fire_event]
            [/then]
            [else]
                [sound]
                    name=magic-faeriefire.ogg
                [/sound]

                {VARIABLE_OP monolith add 1}
            [/else]
        [/if]
    [/event]

    # Conversation events with the orcs.
    # The original version of the characters are retained for now.
    [event]
        name=sighted
        [filter]
            side=2,3
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=unit
            message= _ "The undead are attacking us! To arms!"
        [/message]
        [message]
            speaker="Gwiti Ha'atel"
            message= _ "Orcs? This is the first time I have confronted them since the Battle of Erzen... Their corpses and souls shall soon cover the battlefield."
            scroll=no
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Karz Gholum
        [/filter]
        [message]
            speaker=unit
            message= _ "I was defeated by the evil undead! Avenge me!"
        [/message]
        [gold]
            side=3
            amount={ON_DIFFICULTY 40 60 80}
        [/gold]
    [/event]
    [event]
        name=last breath
        [filter]
            id=Nakur Kimoni
        [/filter]
        [message]
            speaker=unit
            message= _ "We conquered this land and were soon destroyed... What have we been fighting for?"
        [/message]
    [/event]
    [event]
        name=last breath
        [filter]
            id="Isidal B'Tai"
        [/filter]
        [message]
            speaker=unit
            message= _ "Argh! I die!"
        [/message]
    [/event]

    #############################
    # SECOND STAGE
    #############################
    [event]
        name=second_stage
        [kill]
            side=2,3
            fire_event=no
        [/kill]

        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}
        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}

        [store_unit]
            [filter]
                id="Gwiti Ha'atel"
            [/filter]
            kill=yes
            variable=gwiti_store
        [/store_unit]
        {PUT_TO_RECALL_LIST (side=1)}

        {FADE_STEP -32 250}
        {FADE_STEP -64 250}
        {FADE_STEP -96 250}
        {FADE_STEP -128 250}
        {FADE_STEP -160 250}
        {FADE_STEP -192 250}
        {FADE_STEP -224 250}
        {FADE_STEP -500 750}

        [remove_sound_source]
            id=campfire_enemy
        [/remove_sound_source]

        [remove_item]
            x,y=18,12
        [/remove_item]
        [remove_item]
            x,y=34,5
        [/remove_item]
        [remove_item]
            x,y=44,12
        [/remove_item]
        [remove_item]
            x,y=58,2
        [/remove_item]

        [place_shroud]
            side=1
        [/place_shroud]

        [message]
            speaker=narrator
            message= _ "Some time passes..."
            image=none
        [/message]

        [replace_map]
            map_file=03x_Tree_Brothers_Gate.map
            expand,shrink=yes,yes
        [/replace_map]

        {PLACE_IMAGE items/gohere.png 10 1}

        [replace_schedule]
            {UNDERGROUND}
        [/replace_schedule]
        [modify_turns]
             value=unlimited
        [/modify_turns]

        [delay]
            time=2000
        [/delay]

        [modify_side]
            side=1
            fog=no
            shroud=no
            income=-2
        [/modify_side]
        [redraw]
            side=1
        [/redraw]

        {VARIABLE gwiti_store.x 10}
        {VARIABLE gwiti_store.y 8}
        {VARIABLE gwiti_store.facing nw}
        {VARIABLE gwiti_store.moves 6}

        [scroll_to]
            x,y=$gwiti_store.x,$gwiti_store.y
            immediate=yes
        [/scroll_to]

        {FADE_STEP -500 750}
        {FADE_STEP -224 250}
        {FADE_STEP -192 250}
        {FADE_STEP -160 250}
        {FADE_STEP -128 250}
        {FADE_STEP -96 250}
        {FADE_STEP -64 250}
        {FADE_STEP -32 250}

        [unstore_unit]
            variable=gwiti_store
        [/unstore_unit]
        {FULL_HEAL side=1}
        {CLEAR_VARIABLE gwiti_store}

        [redraw]
            side=1
        [/redraw]

        [delay]
            time=1000
        [/delay]

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "Where the hell am I?"
            sound=wail-sml.wav
        [/message]

        {REPLACE_SCENARIO_MUSIC snowfall.ogg}

        {MODIFY_UNIT id="Gwiti Ha'atel" facing se}
        [delay]
            time=1000
        [/delay]
        {MODIFY_UNIT id="Gwiti Ha'atel" facing nw}
        [delay]
            time=1000
        [/delay]

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "Perhaps I am not on the Earth now... Here is the space charged by the magic."
        [/message]

        # The elves who appear here are fallen spirits.
        # Ideally, they should be original units and sprites.

        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        {NOTRAIT_UNIT 4 (Elvish Shyde) 7 5} {ANIMATE}
        [+unit]
            canrecruit=yes
            [modifications]
                {TRAIT_UNDEAD}
                [object]
                    [effect]
                        apply_to=profile
                        portrait=unit_image
                    [/effect]
                    [effect]
                        apply_to=halo
                        halo=halo/darkens-aura.png
                    [/effect]
                [/object]
            [/modifications]
        [/unit]

        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        {NOTRAIT_UNIT 4 (Elvish Shyde) 13 5} {ANIMATE}
        [+unit]
            canrecruit=yes
            [modifications]
                {TRAIT_UNDEAD}
                [object]
                    [effect]
                        apply_to=profile
                        portrait=unit_image
                    [/effect]
                    [effect]
                        apply_to=halo
                        halo=halo/darkens-aura.png
                    [/effect]
                [/object]
            [/modifications]
        [/unit]

        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        {NOTRAIT_UNIT 4 (Elvish Sorceress) 15 7} {ANIMATE}
        [+unit]
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_UNDEAD}
                [object]
                    [effect]
                        apply_to=profile
                        portrait=unit_image
                    [/effect]
                    [effect]
                        apply_to=halo
                        halo=halo/darkens-aura.png~SCALE(150,150)
                    [/effect]
                [/object]
            [/modifications]
        [/unit]

        [sound]
            name=magic-faeriefire.ogg
        [/sound]

        {NOTRAIT_UNIT 4 (Elvish Sorceress) 6 6} {ANIMATE}
        [+unit]
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_UNDEAD}
                [object]
                    [effect]
                        apply_to=profile
                        portrait=unit_image
                    [/effect]
                    [effect]
                        apply_to=halo
                        halo=halo/darkens-aura.png~SCALE(150,150)
                    [/effect]
                [/object]
            [/modifications]
        [/unit]

        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}
        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "They are not elves. They are just fakes."
        [/message]

        [move_unit]
            id="Gwiti Ha'atel"
            to_x,to_y=10,9
        [/move_unit]

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "<i>Is this what I get for following your words?</i>"
        [/message]

        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}
        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}

        [animate_unit]
            [filter]
                id="Gwiti Ha'atel"
            [/filter]
            flag=attack
            hits=yes
            [primary_attack]
                range=ranged
            [/primary_attack]
        [/animate_unit]

        {RECALL_HIGHEST 10 8}
        {RECALL_HIGHEST 9 9}
#ifdef EASY
        {RECALL_HIGHEST 9 10}
        {RECALL_HIGHEST 10 10}
        {RECALL_HIGHEST 11 10}
#endif
#ifdef NORMAL
        {RECALL_HIGHEST 9 10}
        {RECALL_HIGHEST 10 10}
#endif
#ifdef HARD
        {RECALL_HIGHEST 9 10}
#endif
        [modify_unit]
            [filter]
                side=1
                canrecruit=no
            [/filter]
            [object]
                duration=scenario
                [effect]
                    apply_to=loyal
                [/effect]
            [/object]
        [/modify_unit]
        {FULL_HEAL side=1}

        {MYSTERIOUS_VOICE ( _ "You have completed the ritual. So you must see the artifact in your eyes... But you must finally get the key to the Skull of Morgorath. In other words: the doom of the Guardians.")}
        {HIGHLIGHT_IMAGE 10 1 items/gohere.png ()}

        [scroll_to_unit]
            id="Gwiti Ha'atel"
        [/scroll_to_unit]

        [objectives]
            side=1
            [objective]
                condition=win
                description= _ "Defeat both enemy leaders"
            [/objective]
            [objective]
                condition=lose
                description= _ "Death of Gwiti Ha’atel"
            [/objective]

            [gold_carryover]
                bonus=no
                carryover_percentage=80
            [/gold_carryover]
        [/objectives]

        {VARIABLE second_stage yes}
    [/event]

    # Set the appearance of enemy reinforcements.
    [event]
        id=spawn_shamans
        name=side 4 turn
        first_time_only=no
        [filter_condition]
            [variable]
                name=second_stage
                boolean_equals=yes
            [/variable]
        [/filter_condition]

        [random_placement]
            num_items={ON_DIFFICULTY 1 2 4}
            variable=loc
            min_distance=4
            [filter_location]
                terrain=*^F*
                [not]
                    [filter][/filter]
                [/not]
            [/filter_location]
            [command]
                {NOTRAIT_UNIT 4 (Elvish Shaman) $loc.x $loc.y} {ANIMATE}
                [+unit]
                    [modifications]
                        {TRAIT_LOYAL}
                        {TRAIT_UNDEAD}
                        [object]
                            [effect]
                                apply_to=profile
                                portrait=unit_image
                            [/effect]
                        [/object]
                    [/modifications]
                [/unit]
            [/command]
        [/random_placement]
    [/event]

    # Encourage the player to make the final move.
    [event]
        name=die
        first_time_only=no
        [filter]
            side=4
            canrecruit=yes
        [/filter]
        [filter_condition]
            [variable]
                name=second_stage
                boolean_equals=yes
            [/variable]
        [/filter_condition]
        [if]
            [have_unit]
                side=4
                canrecruit=yes
            [/have_unit]
            [else]
                [kill]
                    x,y=$x1,$y1
                    fire_event=no
                    animate=no
                [/kill]
                [kill]
                    side=4
                    fire_event=no
                    animate=yes
                [/kill]

                {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}
                {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}

                [terrain]
                    x=10
                    y=3
                    terrain=Isa^Qhh
                [/terrain]
                {HIGHLIGHT_IMAGE 10 1 items/gohere.png ()}
                [message]
                    speaker="Gwiti Ha'atel"
                    message= _ "The way to the Skull was opened!"
                [/message]

                [objectives]
                    side=1
                    [objective]
                        condition=win
                        description= _ "Take the Skull of Morgorath"
                    [/objective]
                    [objective]
                        condition=lose
                        description= _ "Death of Gwiti Ha’atel"
                    [/objective]

                    [gold_carryover]
                        bonus=no
                        carryover_percentage=80
                    [/gold_carryover]
                [/objectives]
                [remove_event]
                    id=spawn_shamans
                [/remove_event]
            [/else]
        [/if]
    [/event]

    #############################
    # THE FINAL
    #############################
    [event]
        name=moveto
        first_time_only=no
        [filter]
            id="Gwiti Ha'atel"
            x,y=10,1
        [/filter]
        [filter_condition]
            [variable]
                name=second_stage
                boolean_equals=yes
            [/variable]
        [/filter_condition]

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "Argh! This Skull is only the half!"
        [/message]

        {MYSTERIOUS_VOICE ( _ "Now that is enough.")}

        [sound]
            name=wail-sml.wav
        [/sound]

        [message]
            speaker="Gwiti Ha'atel"
            message= _ "What does that mean? I am tired of hearing your words... <b>Do not approach me again!</b>"
        [/message]

        {THUNDER ()}

        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}
        {QUAKE (rumble.ogg,cave-in.ogg,explosion.ogg)}

        [delay]
            time=500
        [/delay]

        # Go straight to the next scenario.
        [endlevel]
            result=victory
            bonus=no
            carryover_report=no
            linger_mode=no
            {NEW_GOLD_CARRYOVER 80}
        [/endlevel]
    [/event]

    # Remove unnecessary variables.
    [event]
        name=victory
        {CLEAR_VARIABLE monolith,second_stage}
    [/event]

    [event]
        name=last breath
        [filter]
            id="Gwiti Ha'atel"
        [/filter]
        [message]
            speaker=unit
            message= _ "I perish here and now, darkness embraces me forever..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
[/scenario]
